---
layout: default
---

{% assign features = site.config.features %}

<div class="container">
  <article class="post surface-panel">
    <header class="post-header">
      <h1 class="post-title">{{ page.title }}</h1>
      <p class="post-meta">
        <span class="meta-item">
          <span class="meta-label">发布于</span>
          <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y-%m-%d" }}</time>
        </span>
        {% if page.categories %}
        <span class="meta-item meta-categories">
          <span class="meta-label">分类</span>
          {% for c in page.categories %}<span class="badge">{{ c }}</span>{% endfor %}
        </span>
        {% endif %}
        {% if page.tags %}
        <span class="meta-item meta-tags">
          <span class="meta-label">标签</span>
          {% for t in page.tags %}<span class="tag">{{ t }}</span>{% endfor %}
        </span>
        {% endif %}
      </p>
    </header>

    {% if features and features.toc and page.toc != false %}
    <div class="post-grid">
      <div class="post-content">
        {{ content }}
      </div>
      {% include toc.html %}
    </div>
    {% else %}
      <div class="post-content">
        {{ content }}
      </div>
    {% endif %}

    {% if page.gallery %}
    <section class="post-gallery">
      <h3>图集</h3>
      <div class="gallery-grid">
        {% for item in page.gallery %}
          <figure>
            <img src="{{ item.image | relative_url }}" alt="{{ item.caption | default: 'image' }}" loading="lazy" />
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    {% if page.attachments %}
    <section class="post-attachments">
      <h3>附件</h3>
      <ul>
        {% for a in page.attachments %}
          {% assign f = a.file | downcase %}
          {% if f contains '.pdf' and a.embed != false %}
            </ul>
            <div class="pdf-embed">
              <object data="{{ a.file | relative_url }}" type="application/pdf">
                <p>无法内嵌预览，请 <a href="{{ a.file | relative_url }}" target="_blank" rel="noopener">单独打开 {{ a.title | default: a.file | split: '/' | last }}</a></p>
              </object>
              <p><a href="{{ a.file | relative_url }}" target="_blank" rel="noopener">下载 {{ a.title | default: a.file | split: '/' | last }}</a></p>
            </div>
            <ul>
          {% else %}
            <li><a href="{{ a.file | relative_url }}" target="_blank" rel="noopener">{{ a.title | default: a.file | split: '/' | last }}</a></li>
          {% endif %}
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <section id="related" class="panel related-posts">
      <h3>相关推荐</h3>
      <div class="cards-grid" id="related-cards"></div>
    </section>

    <footer class="post-footer">
      <a class="btn secondary" href="{{ '/' | relative_url }}">返回首页</a>
    </footer>
  </article>
</div>

<script id="related-posts-data" type="application/json">
[{% assign candidates = site.posts | where_exp: 'p', 'p.url != page.url' %}{% assign limited = candidates | slice: 0, 40 %}{% for post in limited %}
  {
    "title": {{ post.title | jsonify }},
    "url": {{ post.url | relative_url | jsonify }},
    "cover": {{ post.cover | default: '/assets/img/cover.svg' | relative_url | jsonify }},
    "summary": {{ post.summary | default: post.excerpt | strip_html | strip_newlines | truncate: 160 | jsonify }},
    "date": {{ post.date | date: '%Y-%m-%d' | jsonify }},
    "date_iso": {{ post.date | date_to_xmlschema | jsonify }},
    "categories": {{ post.categories | jsonify }},
    "tags": {{ post.tags | jsonify }},
    "words": {{ post.content | number_of_words }}
  }{% unless forloop.last %},{% endunless %}{% endfor %}
]
</script>

{% include comments.html %}